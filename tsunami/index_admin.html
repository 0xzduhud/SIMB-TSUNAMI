<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Waver — Admin Dashboard</title>

  <!-- FONT & LIBRARY -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    :root {
      --primary: #0057ff;
      --secondary: #007bff;
      --dark: #001b44;
      --light: #f8faff;
      --accent: #00d4ff;
      --success: #28a745;
      --danger: #dc3545;
      --warning: #ffc107;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #f8faff 0%, #e6f0ff 100%);
      color: #333;
      min-height: 100vh;
      display: flex;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 280px;
      background: linear-gradient(135deg, var(--dark) 0%, #002855 100%);
      color: white;
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      padding: 30px 0;
      box-shadow: 5px 0 20px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      transition: all 0.3s ease;
      overflow-y: auto;
    }

    .sidebar-header {
      text-align: center;
      padding: 0 25px 30px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      margin-bottom: 30px;
    }

    .sidebar-header img {
      width: 100px;
      height: auto;
      margin-bottom: 15px;
    }

    .sidebar-header h2 {
      font-size: 22px;
      font-weight: 700;
      color: white;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
    }

    .sidebar-menu li {
      margin-bottom: 5px;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 15px 25px;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      transition: all 0.3s ease;
      font-weight: 600;
      border-left: 4px solid transparent;
    }

    .sidebar-menu a:hover,
    .sidebar-menu a.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border-left-color: var(--accent);
    }

    .sidebar-menu i {
      font-size: 18px;
      width: 24px;
      text-align: center;
    }

    /* ===== MAIN CONTENT ===== */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 30px;
      transition: all 0.3s ease;
    }

    /* ===== HEADER ===== */
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #e0e0e0;
    }

    .header h1 {
      font-size: 32px;
      font-weight: 800;
      color: var(--primary);
      margin: 0;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-avatar {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 18px;
    }

    .user-details h4 {
      font-size: 16px;
      font-weight: 700;
      margin: 0;
      color: var(--dark);
    }

    .user-details p {
      font-size: 14px;
      color: #666;
      margin: 0;
    }

    /* ===== DASHBOARD CARDS ===== */
    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 25px;
      margin-bottom: 40px;
    }

    .card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      padding: 25px;
      transition: all 0.3s ease;
      border: none;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
    }

    .card-icon {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      font-size: 24px;
      color: white;
    }

    .card-icon.primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
    }

    .card-icon.success {
      background: linear-gradient(135deg, var(--success), #2ecc71);
    }

    .card-icon.warning {
      background: linear-gradient(135deg, var(--warning), #f1c40f);
    }

    .card-icon.danger {
      background: linear-gradient(135deg, var(--danger), #e74c3c);
    }

    .card h3 {
      font-size: 28px;
      font-weight: 800;
      color: var(--dark);
      margin-bottom: 5px;
    }

    .card p {
      font-size: 14px;
      color: #666;
      margin: 0;
    }

    /* ===== CONTENT SECTIONS ===== */
    .content-section {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      padding: 30px;
      margin-bottom: 30px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eaeaea;
    }

    .section-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--dark);
      margin: 0;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s ease;
      border: none;
      cursor: pointer;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 87, 255, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success), #2ecc71);
      color: white;
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--danger), #e74c3c);
      color: white;
    }

    .btn-warning {
      background: linear-gradient(135deg, var(--warning), #f1c40f);
      color: var(--dark);
    }

    /* ===== TABLE STYLING ===== */
    .table-container {
      overflow-x: auto;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 15px 20px;
      text-align: left;
      border-bottom: 1px solid #eaeaea;
    }

    th {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-size: 14px;
    }

    tr {
      transition: all 0.3s ease;
    }

    tr:hover {
      background-color: #f8faff;
    }

    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
    }

    .status-active {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success);
      border: 1px solid var(--success);
    }

    .status-inactive {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .status-pending {
      background: rgba(255, 193, 7, 0.1);
      color: var(--warning);
      border: 1px solid var(--warning);
    }

    .status-danger {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
      border: 1px solid var(--danger);
    }

    .status-warning {
      background: rgba(255, 193, 7, 0.1);
      color: var(--warning);
      border: 1px solid var(--warning);
    }

    .action-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
      border-radius: 6px;
    }

    /* ===== FORM PAGE STYLING ===== */
    .form-page {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      padding: 30px;
      margin-bottom: 30px;
    }

    .form-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 1px solid #eaeaea;
    }

    .form-header h2 {
      font-size: 24px;
      font-weight: 700;
      color: var(--dark);
      margin: 0;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: flex-end;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eaeaea;
    }

    /* ===== DASHBOARD OVERVIEW ===== */
    .dashboard-overview {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 30px;
    }

    .recent-activity {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      padding: 30px;
    }

    .activity-list {
      list-style: none;
      padding: 0;
    }

    .activity-item {
      display: flex;
      align-items: flex-start;
      gap: 15px;
      padding: 15px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      flex-shrink: 0;
    }

    .activity-content {
      flex: 1;
    }

    .activity-content h4 {
      font-size: 14px;
      font-weight: 600;
      margin: 0 0 5px;
      color: var(--dark);
    }

    .activity-content p {
      font-size: 13px;
      color: #666;
      margin: 0;
    }

    .activity-time {
      font-size: 12px;
      color: #999;
    }

    /* ===== FORM STYLING ===== */
    .form-group {
      margin-bottom: 25px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: "Inter", sans-serif;
      font-size: 14px;
      transition: border-color 0.3s ease;
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(0, 87, 255, 0.1);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 120px;
    }

    /* ===== NOTIFICATION STYLES ===== */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 9999;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transform: translateX(150%);
      transition: transform 0.3s ease;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification.success {
      background: var(--success);
    }

    .notification.error {
      background: var(--danger);
    }

    .notification.warning {
      background: var(--warning);
      color: var(--dark);
    }

    /* ===== MAP STYLES ===== */
    .tab-btn {
      padding: 12px 20px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      font-weight: 600;
      color: #666;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 14px;
    }

    .tab-btn.active {
      color: var(--primary);
      border-bottom-color: var(--primary);
      background: rgba(0, 87, 255, 0.05);
    }

    .tab-btn:hover {
      color: var(--primary);
      background: rgba(0, 87, 255, 0.02);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .map-preview-container {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      margin-bottom: 30px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 992px) {
      .sidebar {
        width: 80px;
      }
      
      .sidebar-header h2,
      .sidebar-menu span {
        display: none;
      }
      
      .sidebar-menu a {
        justify-content: center;
        padding: 15px;
      }
      
      .main-content {
        margin-left: 80px;
      }
      
      .dashboard-overview {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 768px) {
      .main-content {
        padding: 20px;
      }
      
      .dashboard-cards {
        grid-template-columns: 1fr;
      }
      
      .header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .user-info {
        align-self: flex-end;
      }
      
      .form-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .form-actions {
        flex-direction: column;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 480px) {
      .sidebar {
        width: 60px;
      }
      
      .main-content {
        margin-left: 60px;
        padding: 15px;
      }
      
      .content-section {
        padding: 20px;
      }
      
      .form-page {
        padding: 20px;
      }
    }
  </style>
</head>

<body>
  <!-- ===== NOTIFICATION ===== -->
  <div id="notification" class="notification"></div>

  <!-- ===== SIDEBAR ===== -->
  <div class="sidebar">
    <div class="sidebar-header">
      <img src="img/tsunamelogo.png" alt="Tsuname Logo" />
      <h2>Admin Panel</h2>
    </div>
    
    <ul class="sidebar-menu">
      <li><a href="#" class="active" onclick="showSection('dashboard')"><i class="fas fa-tachometer-alt"></i> <span>Dashboard</span></a></li>
      <li><a href="#" onclick="showSection('incidents')"><i class="fas fa-history"></i> <span>Riwayat Kejadian</span></a></li>
      <li><a href="#" onclick="showSection('articles')"><i class="fas fa-newspaper"></i> <span>Artikel & Berita</span></a></li>
      <li><a href="#" onclick="showSection('volunteers')"><i class="fas fa-hands-helping"></i> <span>Volunteer</span></a></li>
      <li><a href="#" onclick="showMapSection()"><i class="fas fa-map-marked-alt"></i> <span>Kelola Peta</span></a></li>
      <li><a href="index_tsunami_user.html"><i class="fas fa-sign-out-alt"></i> <span>Kembali ke User</span></a></li>
    </ul>
  </div>

  <!-- ===== MAIN CONTENT ===== -->
  <div class="main-content">
    
    <!-- Header -->
    <div class="header">
      <h1 id="page-title">Dashboard Admin</h1>
      <div class="user-info">
        <div class="user-avatar">A</div>
        <div class="user-details">
          <h4>Admin Waver</h4>
          <p>Administrator</p>
        </div>
      </div>
    </div>

    <!-- Dashboard Overview (Default View) -->
    <div id="dashboard-section">
      <!-- Dashboard Cards -->
      <div class="dashboard-cards">
        <div class="card">
          <div class="card-icon primary">
            <i class="fas fa-wave-square"></i>
          </div>
          <h3 id="total-incidents">0</h3>
          <p>Kejadian Tsunami Aktif</p>
        </div>
        
        <div class="card">
          <div class="card-icon success">
            <i class="fas fa-users"></i>
          </div>
          <h3 id="total-volunteers">0</h3>
          <p>Volunteer Terdaftar</p>
        </div>
        
        <div class="card">
          <div class="card-icon warning">
            <i class="fas fa-newspaper"></i>
          </div>
          <h3 id="total-articles">0</h3>
          <p>Artikel Dipublikasi</p>
        </div>
        
        <div class="card">
          <div class="card-icon danger">
            <i class="fas fa-exclamation-triangle"></i>
          </div>
          <h3 id="total-alerts">0</h3>
          <p>Peringatan Darurat</p>
        </div>
      </div>

      <!-- Dashboard Overview -->
      <div class="dashboard-overview">
        <div class="content-section">
          <div class="section-header">
            <h2>Aktivitas Terbaru</h2>
          </div>
          
          <ul class="activity-list" id="recent-activities">
            <!-- Recent activities will be loaded here -->
          </ul>
        </div>
        
        <div class="recent-activity">
          <div class="section-header">
            <h2>Statistik Cepat</h2>
          </div>
          
          <div class="quick-stats">
            <div class="stat-item" style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
              <span>Kejadian Aktif</span>
              <strong id="quick-incidents">0</strong>
            </div>
            <div class="stat-item" style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
              <span>Volunteer Baru (Bulan Ini)</span>
              <strong id="quick-volunteers">0</strong>
            </div>
            <div class="stat-item" style="display: flex; justify-content: space-between; padding: 15px 0; border-bottom: 1px solid #f0f0f0;">
              <span>Artikel Baru (Minggu Ini)</span>
              <strong id="quick-articles">0</strong>
            </div>
            <div class="stat-item" style="display: flex; justify-content: space-between; padding: 15px 0;">
              <span>Peringatan Aktif</span>
              <strong id="quick-alerts">0</strong>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Incidents Management Section -->
    <div class="content-section" id="incidents-section" style="display: none;">
      <div class="section-header">
        <h2>Kelola Riwayat Kejadian</h2>
        <button class="btn btn-primary" onclick="showSection('add-incident')">
          <i class="fas fa-plus"></i>
          Tambah Kejadian
        </button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Lokasi</th>
              <th>Magnitudo</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="incidents-table">
            <!-- Incidents data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add Incident Form Page -->
    <div class="form-page" id="add-incident-section" style="display: none;">
      <div class="form-header">
        <h2 id="form-title">Tambah Kejadian Tsunami Baru</h2>
        <button class="btn" onclick="showSection('incidents')">
          <i class="fas fa-arrow-left"></i>
          Kembali
        </button>
      </div>
      
      <form id="incident-form">
        <input type="hidden" id="edit-index" value="-1">
        <div class="form-group">
          <label for="incident-date">Tanggal Kejadian *</label>
          <input type="date" id="incident-date" class="form-control" required>
        </div>
        
        <div class="form-group">
          <label for="incident-location">Lokasi *</label>
          <input type="text" id="incident-location" class="form-control" placeholder="Masukkan lokasi kejadian" required>
        </div>
        
        <div class="form-group">
          <label for="incident-magnitude">Magnitudo *</label>
          <input type="number" id="incident-magnitude" class="form-control" placeholder="Masukkan magnitudo" step="0.1" min="0" required>
        </div>
        
        <div class="form-group">
          <label for="incident-depth">Kedalaman (km) *</label>
          <input type="number" id="incident-depth" class="form-control" placeholder="Masukkan kedalaman gempa" step="0.1" min="0" required>
        </div>
        
        <div class="form-group">
          <label for="incident-status">Status *</label>
          <select id="incident-status" class="form-control" required>
            <option value="">Pilih Status</option>
            <option value="aktif">Aktif</option>
            <option value="pemantauan">Pemantauan</option>
            <option value="selesai">Selesai</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="incident-description">Deskripsi</label>
          <textarea id="incident-description" class="form-control" placeholder="Tulis deskripsi kejadian di sini" rows="6"></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn" onclick="showSection('incidents')">
            <i class="fas fa-times"></i>
            Batal
          </button>
          <button type="button" class="btn btn-primary" onclick="saveIncident()">
            <i class="fas fa-save"></i>
            <span id="save-button-text">Simpan Kejadian</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Articles Management Section -->
    <div class="content-section" id="articles-section" style="display: none;">
      <div class="section-header">
        <h2>Kelola Artikel & Berita</h2>
        <button class="btn btn-primary" onclick="showSection('add-article')">
          <i class="fas fa-plus"></i>
          Tambah Artikel
        </button>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Judul</th>
              <th>Kategori</th>
              <th>Tanggal</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="articles-table">
            <!-- Articles data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Add Article Form Page -->
    <div class="form-page" id="add-article-section" style="display: none;">
      <div class="form-header">
        <h2 id="article-form-title">Tambah Artikel Baru</h2>
        <button class="btn" onclick="showSection('articles')">
          <i class="fas fa-arrow-left"></i>
          Kembali
        </button>
      </div>
      
      <form id="article-form">
        <input type="hidden" id="article-edit-index" value="-1">
        <div class="form-group">
          <label for="article-title">Judul Artikel *</label>
          <input type="text" id="article-title" class="form-control" placeholder="Masukkan judul artikel" required>
        </div>
        
        <div class="form-group">
          <label for="article-category">Kategori *</label>
          <select id="article-category" class="form-control" required>
            <option value="">Pilih Kategori</option>
            <option value="Berita Utama">Berita Utama</option>
            <option value="Tips & Edukasi">Tips & Edukasi</option>
            <option value="Penelitian">Penelitian</option>
            <option value="Kebijakan">Kebijakan</option>
            <option value="Lainnya">Lainnya</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="article-date">Tanggal Publikasi *</label>
          <input type="date" id="article-date" class="form-control" required>
        </div>
        
        <div class="form-group">
          <label for="article-image">URL Gambar</label>
          <input type="text" id="article-image" class="form-control" placeholder="Masukkan URL gambar (opsional)">
        </div>

        <div class="form-group">
          <label for="article-external-link">Link Artikel Eksternal *</label>
          <input type="url" id="article-external-link" class="form-control" placeholder="https://example.com/artikel-lengkap" required>
        </div>
        
        <div class="form-group">
          <label for="article-content">Konten Artikel *</label>
          <textarea id="article-content" class="form-control" placeholder="Tulis konten artikel di sini" rows="10" required></textarea>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn" onclick="showSection('articles')">
            <i class="fas fa-times"></i>
            Batal
          </button>
          <button type="button" class="btn btn-primary" onclick="saveArticle()">
            <i class="fas fa-save"></i>
            <span id="save-article-button-text">Simpan Artikel</span>
          </button>
        </div>
      </form>
    </div>

    <!-- Volunteers Management Section -->
    <div class="content-section" id="volunteers-section" style="display: none;">
      <div class="section-header">
        <h2>Kelola Data Volunteer</h2>
        <button class="btn btn-success" onclick="exportVolunteerData()">
          <i class="fas fa-download"></i>
          Export Data
        </button>
      </div>
      
      <!-- Filter & Stats -->
      <div class="volunteer-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
          <h4 style="color: var(--primary); margin: 0 0 5px 0;">Total Volunteer</h4>
          <h2 id="total-volunteers-count" style="margin: 0; font-size: 32px;">0</h2>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
          <h4 style="color: var(--success); margin: 0 0 5px 0;">Bulan Ini</h4>
          <h2 id="monthly-volunteers-count" style="margin: 0; font-size: 32px;">0</h2>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
          <h4 style="color: var(--warning); margin: 0 0 5px 0;">Minggu Ini</h4>
          <h2 id="weekly-volunteers-count" style="margin: 0; font-size: 32px;">0</h2>
        </div>
      </div>
      
      <!-- Filter Section -->
      <div class="filter-section" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 3px 10px rgba(0,0,0,0.08);">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
          <div class="form-group" style="margin: 0;">
            <label>Cari Volunteer</label>
            <input type="text" id="search-volunteer" class="form-control" placeholder="Cari nama, email, atau lokasi...">
          </div>
          <div class="form-group" style="margin: 0;">
            <label>Filter Lokasi</label>
            <select id="filter-location" class="form-control">
              <option value="">Semua Lokasi</option>
            </select>
          </div>
          <div class="form-group" style="margin: 0;">
            <label>Urutkan</label>
            <select id="sort-volunteers" class="form-control">
              <option value="newest">Terbaru</option>
              <option value="oldest">Terlama</option>
              <option value="name">Nama (A-Z)</option>
            </select>
          </div>
        </div>
      </div>
      
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <th>Tanggal Daftar</th>
              <th>Nama Lengkap</th>
              <th>Email</th>
              <th>Telepon</th>
              <th>Lokasi</th>
              <th>Usia</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="volunteers-table">
            <!-- Volunteers data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Modal Detail Volunteer -->
    <div id="volunteer-detail-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 9999; overflow-y: auto;">
      <div style="max-width: 700px; margin: 50px auto; background: white; border-radius: 20px; padding: 40px; position: relative;">
        <button onclick="closeVolunteerModal()" style="position: absolute; top: 20px; right: 20px; background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
        
        <h2 style="margin-bottom: 30px; color: var(--primary);">
          <i class="fas fa-user-circle"></i> Detail Volunteer
        </h2>
        
        <div id="volunteer-detail-content">
          <!-- Content will be loaded dynamically -->
        </div>
        
        <div style="margin-top: 30px; display: flex; gap: 15px; justify-content: flex-end;">
          <button class="btn" onclick="closeVolunteerModal()">
            <i class="fas fa-times"></i> Tutup
          </button>
          <button class="btn btn-danger" onclick="deleteVolunteerFromModal()">
            <i class="fas fa-trash"></i> Hapus
          </button>
        </div>
      </div>
    </div>

    <!-- Maps Management Section -->
    <div class="content-section" id="maps-section" style="display: none;">
      <div class="section-header">
        <h2>Kelola Data Peta</h2>
        <button class="btn btn-primary" onclick="showSection('add-map-data')">
          <i class="fas fa-plus"></i>
          Tambah Data Peta
        </button>
      </div>
      
      <!-- Map Preview -->
      <div class="map-preview-container" style="margin-bottom: 30px;">
        <div class="section-header">
          <h3>Preview Peta</h3>
          <button class="btn btn-success" onclick="refreshMapPreview()">
            <i class="fas fa-sync-alt"></i>
            Refresh Peta
          </button>
        </div>
        <div id="map-preview" style="height: 400px; width: 100%; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);"></div>
      </div>
      
      <!-- Data Management Tabs -->
      <div class="data-tabs" style="margin-bottom: 20px;">
        <div class="tabs-header" style="display: flex; gap: 10px; border-bottom: 2px solid #eaeaea; margin-bottom: 20px;">
          <button class="tab-btn active" onclick="showMapTab('posko', this)">Posko Evakuasi</button>
          <button class="tab-btn" onclick="showMapTab('rawan', this)">Daerah Rawan</button>
          <button class="tab-btn" onclick="showMapTab('tsunami', this)">Zona Tsunami</button>
        </div>
        
        <!-- Posko Tab -->
        <div id="posko-tab" class="tab-content">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Nama Posko</th>
                  <th>Lokasi</th>
                  <th>Latitude</th>
                  <th>Longitude</th>
                  <th>Kapasitas</th>
                  <th>Kontak</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="posko-table">
                <!-- Posko data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Daerah Rawan Tab -->
        <div id="rawan-tab" class="tab-content" style="display: none;">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Nama Daerah</th>
                  <th>Lokasi</th>
                  <th>Latitude</th>
                  <th>Longitude</th>
                  <th>Level Bahaya</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="rawan-table">
                <!-- Daerah rawan data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
        
        <!-- Zona Tsunami Tab -->
        <div id="tsunami-tab" class="tab-content" style="display: none;">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Nama Zona</th>
                  <th>Lokasi</th>
                  <th>Latitude</th>
                  <th>Longitude</th>
                  <th>Radius (km)</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody id="tsunami-table">
                <!-- Tsunami zone data will be loaded here -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Add Map Data Form Page -->
    <div class="form-page" id="add-map-data-section" style="display: none;">
      <div class="form-header">
        <h2 id="map-form-title">Tambah Data Peta Baru</h2>
        <button class="btn" onclick="showSection('maps')">
          <i class="fas fa-arrow-left"></i>
          Kembali
        </button>
      </div>
      
      <form id="map-data-form">
        <input type="hidden" id="map-edit-index" value="-1">
        <input type="hidden" id="map-data-type" value="posko">
        
        <div class="form-group">
          <label for="data-type">Tipe Data *</label>
          <select id="data-type" class="form-control" onchange="changeMapDataType()" required>
            <option value="posko">Posko Evakuasi</option>
            <option value="rawan">Daerah Rawan</option>
            <option value="tsunami">Zona Tsunami</option>
          </select>
        </div>
        
        <!-- Common Fields -->
        <div class="form-group">
          <label for="map-name">Nama *</label>
          <input type="text" id="map-name" class="form-control" placeholder="Masukkan nama lokasi" required>
        </div>
        
        <div class="form-group">
          <label for="map-location">Lokasi *</label>
          <input type="text" id="map-location" class="form-control" placeholder="Masukkan deskripsi lokasi" required>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="map-lat">Latitude *</label>
            <input type="number" id="map-lat" class="form-control" placeholder="Contoh: -0.89" step="any" required>
          </div>
          
          <div class="form-group">
            <label for="map-lng">Longitude *</label>
            <input type="number" id="map-lng" class="form-control" placeholder="Contoh: 119.87" step="any" required>
          </div>
        </div>
        
        <!-- Posko Specific Fields -->
        <div id="posko-fields">
          <div class="form-group">
            <label for="map-capacity">Kapasitas *</label>
            <input type="number" id="map-capacity" class="form-control" placeholder="Masukkan kapasitas orang" required>
          </div>
          
          <div class="form-group">
            <label for="map-contact">Kontak *</label>
            <input type="text" id="map-contact" class="form-control" placeholder="Masukkan nomor kontak" required>
          </div>
        </div>
        
        <!-- Daerah Rawan Specific Fields -->
        <div id="rawan-fields" style="display: none;">
          <div class="form-group">
            <label for="danger-level">Level Bahaya *</label>
            <select id="danger-level" class="form-control">
              <option value="rendah">Rendah</option>
              <option value="sedang">Sedang</option>
              <option value="tinggi">Tinggi</option>
            </select>
          </div>
        </div>
        
        <!-- Tsunami Zone Specific Fields -->
        <div id="tsunami-fields" style="display: none;">
          <div class="form-group">
            <label for="tsunami-radius">Radius (km) *</label>
            <input type="number" id="tsunami-radius" class="form-control" placeholder="Masukkan radius dalam km" step="0.1" min="0">
          </div>
          
          <div class="form-group">
            <label for="tsunami-status">Status *</label>
            <select id="tsunami-status" class="form-control">
              <option value="aktif">Aktif</option>
              <option value="pemantauan">Pemantauan</option>
              <option value="aman">Aman</option>
            </select>
          </div>
        </div>
        
        <div class="form-actions">
          <button type="button" class="btn" onclick="showSection('maps')">
            <i class="fas fa-times"></i>
            Batal
          </button>
          <button type="button" class="btn btn-primary" onclick="saveMapData()">
            <i class="fas fa-save"></i>
            <span id="save-map-button-text">Simpan Data</span>
          </button>
        </div>
      </form>
    </div>

  </div>

  <script>
    // === MAP DATA MANAGEMENT ===
    let mapPreview = null;

    // === MAP SECTION FUNCTIONS ===
    function showMapSection() {
        showSection('maps');
        // Initialize map preview when section is shown
        setTimeout(() => {
            if (!mapPreview) {
                initializeMapPreview();
            } else {
                refreshMapPreview();
            }
            loadMapData();
        }, 100);
    }

    // Initialize map data
    function initializeMapData() {
      if (!localStorage.getItem('mapPosko')) {
        const samplePosko = [
          { name: "Posko Banda Aceh", location: "Banda Aceh", lat: 5.55, lng: 95.32, capacity: 250, contact: "0812-5555-8888" },
          { name: "Posko Cilacap", location: "Cilacap", lat: -7.72, lng: 109.01, capacity: 180, contact: "0813-1234-5678" },
          { name: "Posko Padang", location: "Padang", lat: -0.95, lng: 100.35, capacity: 220, contact: "0814-8888-9999" },
          { name: "Posko Palu", location: "Palu", lat: -0.89, lng: 119.87, capacity: 300, contact: "0812-9999-1212" },
          { name: "Posko Manado", location: "Manado", lat: 1.49, lng: 124.84, capacity: 150, contact: "0822-3210-4321" }
        ];
        localStorage.setItem('mapPosko', JSON.stringify(samplePosko));
      }
      
      if (!localStorage.getItem('mapRawan')) {
        const sampleRawan = [
          { name: "Daerah Rawan Padang", location: "Padang", lat: -0.95, lng: 100.35, dangerLevel: "tinggi" },
          { name: "Daerah Rawan Palu", location: "Palu", lat: -0.9, lng: 119.87, dangerLevel: "tinggi" },
          { name: "Daerah Rawan Bengkulu", location: "Bengkulu", lat: -3.8, lng: 102.26, dangerLevel: "sedang" },
          { name: "Daerah Rawan Banten", location: "Banten", lat: -6.3, lng: 106.1, dangerLevel: "sedang" }
        ];
        localStorage.setItem('mapRawan', JSON.stringify(sampleRawan));
      }
      
      if (!localStorage.getItem('mapTsunami')) {
        const sampleTsunami = [
          { name: "Zona Tsunami Palu", location: "Palu", lat: -0.9, lng: 119.87, radius: 60, status: "pemantauan" }
        ];
        localStorage.setItem('mapTsunami', JSON.stringify(sampleTsunami));
      }
    }

    // Change map data type in form
    function changeMapDataType() {
      const type = document.getElementById('data-type').value;
      document.getElementById('map-data-type').value = type;
      
      // Hide all specific fields
      document.getElementById('posko-fields').style.display = 'none';
      document.getElementById('rawan-fields').style.display = 'none';
      document.getElementById('tsunami-fields').style.display = 'none';
      
      // Show relevant fields
      document.getElementById(type + '-fields').style.display = 'block';
      
      // Update form title
      const titles = {
        'posko': 'Tambah Posko Evakuasi',
        'rawan': 'Tambah Daerah Rawan', 
        'tsunami': 'Tambah Zona Tsunami'
      };
      document.getElementById('map-form-title').textContent = titles[type] + ' Baru';
    }

    // Show map tab
    function showMapTab(tab, element) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      element.classList.add('active');
      
      // Show selected tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.style.display = 'none';
      });
      document.getElementById(tab + '-tab').style.display = 'block';
      
      // Load data for the selected tab
      if (tab === 'posko') {
        loadPoskoData();
      } else if (tab === 'rawan') {
        loadRawanData();
      } else if (tab === 'tsunami') {
        loadTsunamiData();
      }
    }

    // Load map data
    function loadMapData() {
      loadPoskoData();
      loadRawanData();
      loadTsunamiData();
    }

    // Load posko data
    function loadPoskoData() {
      const poskoData = JSON.parse(localStorage.getItem('mapPosko')) || [];
      const tableBody = document.getElementById('posko-table');
      
      tableBody.innerHTML = '';
      
      if (poskoData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 20px;">
              <i class="fas fa-info-circle"></i> Belum ada data posko
            </td>
          </tr>
        `;
        return;
      }
      
      poskoData.forEach((posko, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><strong>${posko.name}</strong></td>
          <td>${posko.location}</td>
          <td>${posko.lat}</td>
          <td>${posko.lng}</td>
          <td>${posko.capacity} orang</td>
          <td>${posko.contact}</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="editMapData('posko', ${index})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteMapData('posko', ${index})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Load daerah rawan data
    function loadRawanData() {
      const rawanData = JSON.parse(localStorage.getItem('mapRawan')) || [];
      const tableBody = document.getElementById('rawan-table');
      
      tableBody.innerHTML = '';
      
      if (rawanData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="6" style="text-align: center; padding: 20px;">
              <i class="fas fa-info-circle"></i> Belum ada data daerah rawan
            </td>
          </tr>
        `;
        return;
      }
      
      rawanData.forEach((rawan, index) => {
        const dangerLevelText = {
          'rendah': 'Rendah',
          'sedang': 'Sedang', 
          'tinggi': 'Tinggi'
        }[rawan.dangerLevel] || rawan.dangerLevel;
        
        const dangerLevelClass = {
          'rendah': 'status-active',
          'sedang': 'status-warning',
          'tinggi': 'status-danger'
        }[rawan.dangerLevel] || 'status-pending';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><strong>${rawan.name}</strong></td>
          <td>${rawan.location}</td>
          <td>${rawan.lat}</td>
          <td>${rawan.lng}</td>
          <td><span class="status-badge ${dangerLevelClass}">${dangerLevelText}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="editMapData('rawan', ${index})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteMapData('rawan', ${index})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Load tsunami zone data
    function loadTsunamiData() {
      const tsunamiData = JSON.parse(localStorage.getItem('mapTsunami')) || [];
      const tableBody = document.getElementById('tsunami-table');
      
      tableBody.innerHTML = '';
      
      if (tsunamiData.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 20px;">
              <i class="fas fa-info-circle"></i> Belum ada data zona tsunami
            </td>
          </tr>
        `;
        return;
      }
      
      tsunamiData.forEach((tsunami, index) => {
        const statusText = {
          'aktif': 'Aktif',
          'pemantauan': 'Pemantauan',
          'aman': 'Aman'
        }[tsunami.status] || tsunami.status;
        
        const statusClass = {
          'aktif': 'status-danger',
          'pemantauan': 'status-warning', 
          'aman': 'status-active'
        }[tsunami.status] || 'status-pending';
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td><strong>${tsunami.name}</strong></td>
          <td>${tsunami.location}</td>
          <td>${tsunami.lat}</td>
          <td>${tsunami.lng}</td>
          <td>${tsunami.radius} km</td>
          <td><span class="status-badge ${statusClass}">${statusText}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="editMapData('tsunami', ${index})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteMapData('tsunami', ${index})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // Initialize map preview
    function initializeMapPreview() {
      const mapContainer = document.getElementById('map-preview');
      if (!mapContainer) {
        console.log('Map container not found');
        return;
      }
      
      // Clear existing map
      if (mapPreview) {
        mapPreview.remove();
      }
      
      try {
        // Create new map
        mapPreview = L.map('map-preview').setView([-2.5, 118], 5);
        
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          maxZoom: 19,
          attribution: "© OpenStreetMap contributors",
        }).addTo(mapPreview);
        
        // Add markers from data
        addMapDataToPreview();
        
        console.log('✅ Map preview initialized successfully');
      } catch (error) {
        console.error('❌ Error initializing map:', error);
      }
    }

    // Add data to map preview
    function addMapDataToPreview() {
      if (!mapPreview) return;
      
      // Clear existing markers
      mapPreview.eachLayer(layer => {
        if (layer instanceof L.Marker || layer instanceof L.Circle) {
          mapPreview.removeLayer(layer);
        }
      });
      
      // Add posko markers
      const poskoData = JSON.parse(localStorage.getItem('mapPosko')) || [];
      poskoData.forEach(posko => {
        const poskoIcon = L.divIcon({
          html: '<i class="fas fa-home" style="color: #28a745; font-size: 20px;"></i>',
          className: 'custom-posko-icon',
          iconSize: [20, 20],
          iconAnchor: [10, 10]
        });
        
        const marker = L.marker([posko.lat, posko.lng], { icon: poskoIcon }).addTo(mapPreview);
        marker.bindPopup(`
          <div style="min-width: 200px;">
            <h6 style="color: #28a745; margin-bottom: 10px;"><b>${posko.name}</b></h6>
            <p style="margin-bottom: 5px;"><i class="fas fa-users" style="color: #0057ff;"></i> <b>Kapasitas:</b> ${posko.capacity} orang</p>
            <p style="margin-bottom: 0;"><i class="fas fa-phone" style="color: #0057ff;"></i> <b>Kontak:</b> ${posko.contact}</p>
          </div>
        `);
      });
      
      // Add daerah rawan markers
      const rawanData = JSON.parse(localStorage.getItem('mapRawan')) || [];
      rawanData.forEach(rawan => {
        const rawanIcon = L.divIcon({
          html: '<i class="fas fa-exclamation-triangle" style="color: #ffc107; font-size: 20px;"></i>',
          className: 'custom-rawan-icon',
          iconSize: [20, 20],
          iconAnchor: [10, 10]
        });
        
        const marker = L.marker([rawan.lat, rawan.lng], { icon: rawanIcon }).addTo(mapPreview);
        marker.bindPopup(`
          <div style="min-width: 200px;">
            <h6 style="color: #ffc107; margin-bottom: 10px;"><b>${rawan.name}</b></h6>
            <p style="margin-bottom: 0;"><i class="fas fa-map-marker-alt" style="color: #0057ff;"></i> <b>Lokasi:</b> ${rawan.location}</p>
          </div>
        `);
      });
      
      // Add tsunami zones
      const tsunamiData = JSON.parse(localStorage.getItem('mapTsunami')) || [];
      tsunamiData.forEach(tsunami => {
        const circle = L.circle([tsunami.lat, tsunami.lng], {
          color: "red",
          fillColor: "#f03",
          fillOpacity: 0.4,
          radius: tsunami.radius * 1000, // Convert km to meters
        }).addTo(mapPreview);
        
        circle.bindPopup(`
          <div style="min-width: 200px;">
            <h6 style="color: red; margin-bottom: 10px;"><b>${tsunami.name}</b></h6>
            <p style="margin-bottom: 5px;"><i class="fas fa-radiation-alt" style="color: #0057ff;"></i> <b>Status:</b> ${tsunami.status}</p>
            <p style="margin-bottom: 0;"><i class="fas fa-arrows-alt" style="color: #0057ff;"></i> <b>Radius:</b> ${tsunami.radius} km</p>
          </div>
        `);
      });
    }

    // Refresh map preview
    function refreshMapPreview() {
      addMapDataToPreview();
      showNotification('Peta berhasil diperbarui!', 'success');
    }

    // Edit map data
    function editMapData(type, index) {
      const data = JSON.parse(localStorage.getItem('map' + type.charAt(0).toUpperCase() + type.slice(1))) || [];
      const item = data[index];
      
      if (!item) {
        showNotification('Data tidak ditemukan!', 'error');
        return;
      }
      
      // Set form type
      document.getElementById('data-type').value = type;
      changeMapDataType();
      
      // Fill form with data
      document.getElementById('map-name').value = item.name;
      document.getElementById('map-location').value = item.location;
      document.getElementById('map-lat').value = item.lat;
      document.getElementById('map-lng').value = item.lng;
      document.getElementById('map-edit-index').value = index;
      document.getElementById('map-data-type').value = type;
      
      // Fill type-specific fields
      if (type === 'posko') {
        document.getElementById('map-capacity').value = item.capacity;
        document.getElementById('map-contact').value = item.contact;
      } else if (type === 'rawan') {
        document.getElementById('danger-level').value = item.dangerLevel;
      } else if (type === 'tsunami') {
        document.getElementById('tsunami-radius').value = item.radius;
        document.getElementById('tsunami-status').value = item.status;
      }
      
      // Update form title
      const titles = {
        'posko': 'Edit Posko Evakuasi',
        'rawan': 'Edit Daerah Rawan',
        'tsunami': 'Edit Zona Tsunami'
      };
      document.getElementById('map-form-title').textContent = titles[type];
      document.getElementById('save-map-button-text').textContent = 'Update Data';
      
      showSection('add-map-data');
    }

    // Save map data
    function saveMapData() {
      const type = document.getElementById('map-data-type').value;
      const editIndex = parseInt(document.getElementById('map-edit-index').value);
      
      const name = document.getElementById('map-name').value;
      const location = document.getElementById('map-location').value;
      const lat = parseFloat(document.getElementById('map-lat').value);
      const lng = parseFloat(document.getElementById('map-lng').value);
      
      if (!name || !location || isNaN(lat) || isNaN(lng)) {
        showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
        return;
      }
      
      const dataKey = 'map' + type.charAt(0).toUpperCase() + type.slice(1);
      const data = JSON.parse(localStorage.getItem(dataKey)) || [];
      
      const baseData = { name, location, lat, lng };
      
      // Add type-specific data
      if (type === 'posko') {
        const capacity = parseInt(document.getElementById('map-capacity').value);
        const contact = document.getElementById('map-contact').value;
        
        if (!capacity || !contact) {
          showNotification('Harap lengkapi semua field untuk posko!', 'error');
          return;
        }
        
        baseData.capacity = capacity;
        baseData.contact = contact;
        
      } else if (type === 'rawan') {
        const dangerLevel = document.getElementById('danger-level').value;
        baseData.dangerLevel = dangerLevel;
        
      } else if (type === 'tsunami') {
        const radius = parseFloat(document.getElementById('tsunami-radius').value);
        const status = document.getElementById('tsunami-status').value;
        
        if (isNaN(radius)) {
          showNotification('Harap masukkan radius yang valid!', 'error');
          return;
        }
        
        baseData.radius = radius;
        baseData.status = status;
      }
      
      if (editIndex >= 0) {
        data[editIndex] = baseData;
      } else {
        data.push(baseData);
      }
      
      localStorage.setItem(dataKey, JSON.stringify(data));
      
      // Sync to user page
      syncMapDataToUserPage();
      
      if (editIndex >= 0) {
        showNotification('Data peta berhasil diperbarui!', 'success');
      } else {
        showNotification('Data peta berhasil ditambahkan!', 'success');
      }
      
      showSection('maps');
      loadMapData();
      refreshMapPreview();
    }

    // Delete map data
    function deleteMapData(type, index) {
      if (confirm('Apakah Anda yakin ingin menghapus data ini?')) {
        const dataKey = 'map' + type.charAt(0).toUpperCase() + type.slice(1);
        const data = JSON.parse(localStorage.getItem(dataKey)) || [];
        
        data.splice(index, 1);
        localStorage.setItem(dataKey, JSON.stringify(data));
        
        // Sync to user page
        syncMapDataToUserPage();
        
        loadMapData();
        refreshMapPreview();
        showNotification('Data peta berhasil dihapus!', 'success');
      }
    }

    // Sync map data to user page
    function syncMapDataToUserPage() {
      const poskoData = JSON.parse(localStorage.getItem('mapPosko')) || [];
      const rawanData = JSON.parse(localStorage.getItem('mapRawan')) || [];
      const tsunamiData = JSON.parse(localStorage.getItem('mapTsunami')) || [];
      
      localStorage.setItem('userMapPosko', JSON.stringify(poskoData));
      localStorage.setItem('userMapRawan', JSON.stringify(rawanData));
      localStorage.setItem('userMapTsunami', JSON.stringify(tsunamiData));
    }

    // === INITIALIZE DATA ===
    function initializeData() {
      if (!localStorage.getItem('volunteers')) {
        localStorage.setItem('volunteers', JSON.stringify([]));
      }
      if (!localStorage.getItem('incidents')) {
        const sampleIncidents = [
          {
            date: "2024-01-15",
            location: "Palu, Sulawesi Tengah",
            magnitude: 6.9,
            depth: 10.5,
            status: "aktif",
            description: "Tsunami terjadi setelah gempa berkekuatan 6.9 SR",
            createdAt: new Date().toISOString()
          },
          {
            date: "2024-01-10",
            location: "Mentawai, Sumatera Barat", 
            magnitude: 7.1,
            depth: 12.3,
            status: "pemantauan",
            description: "Gempa berkekuatan 7.1 SR berpotensi tsunami",
            createdAt: new Date().toISOString()
          }
        ];
        localStorage.setItem('incidents', JSON.stringify(sampleIncidents));
      }
      if (!localStorage.getItem('articles')) {
        const defaultArticles = [
          { 
            title: "Detik-detik Gempa M 6.9 dan Tsunami Guncang Jepang", 
            category: "Berita Utama", 
            image: "img/jepang.webp",
            content: "Gempa bumi berkekuatan magnitudo 6,9 mengguncang Jepang disusul peringatan tsunami...",
            externalLink: "https://www.cnnindonesia.com/internasional/20240102123435-134-1044566/detik-detik-gempa-m-69-dan-tsunami-guncang-jepang",
            date: new Date().toISOString(),
            createdAt: new Date().toISOString()
          }
        ];
        localStorage.setItem('articles', JSON.stringify(defaultArticles));
      }
    }

    // === SHOW/HIDE SECTIONS ===
    function showSection(section) {
      console.log('Showing section:', section);
      
      const sections = [
        'dashboard', 
        'incidents', 
        'articles',
        'volunteers',
        'maps',
        'add-incident',
        'add-article',
        'add-map-data'
      ];
      
      sections.forEach(sec => {
        const element = document.getElementById(sec + '-section');
        if (element) {
          element.style.display = 'none';
        }
      });
      
      const selectedSection = document.getElementById(section + '-section');
      if (selectedSection) {
        selectedSection.style.display = 'block';
      }
      
      const menuItems = document.querySelectorAll('.sidebar-menu a');
      menuItems.forEach(item => {
        item.classList.remove('active');
        
        if (section === 'dashboard' && item.querySelector('.fa-tachometer-alt')) {
          item.classList.add('active');
        } else if (section === 'incidents' && item.querySelector('.fa-history')) {
          item.classList.add('active');
        } else if (section === 'articles' && item.querySelector('.fa-newspaper')) {
          item.classList.add('active');
        } else if (section === 'volunteers' && item.querySelector('.fa-hands-helping')) {
          item.classList.add('active');
        } else if (section === 'maps' && item.querySelector('.fa-map-marked-alt')) {
          item.classList.add('active');
        }
      });
      
      const titles = {
        'dashboard': 'Dashboard Admin',
        'incidents': 'Riwayat Kejadian',
        'articles': 'Artikel & Berita',
        'volunteers': 'Kelola Data Volunteer',
        'maps': 'Kelola Data Peta',
        'add-incident': 'Tambah Kejadian Baru',
        'add-article': 'Tambah Artikel Baru',
        'add-map-data': 'Tambah Data Peta Baru'
      };
      
      document.getElementById('page-title').textContent = titles[section] || 'Dashboard Admin';
      
      if (section === 'incidents') {
        loadIncidents();
      } else if (section === 'articles') {
        loadArticles();
      } else if (section === 'volunteers') {
        loadVolunteers();
      } else if (section === 'add-incident') {
        resetIncidentForm();
      } else if (section === 'add-article') {
        resetArticleForm();
      } else if (section === 'maps') {
        loadMapData();
        setTimeout(() => {
          if (!mapPreview) {
            initializeMapPreview();
          }
        }, 100);
      }
    }

    // === RESET FORMS ===
    function resetIncidentForm() {
      document.getElementById('incident-form').reset();
      document.getElementById('edit-index').value = '-1';
      document.getElementById('form-title').textContent = 'Tambah Kejadian Tsunami Baru';
      document.getElementById('save-button-text').textContent = 'Simpan Kejadian';
    }

    function resetArticleForm() {
      document.getElementById('article-form').reset();
      document.getElementById('article-edit-index').value = '-1';
      document.getElementById('article-form-title').textContent = 'Tambah Artikel Baru';
      document.getElementById('save-article-button-text').textContent = 'Simpan Artikel';
    }

    // === UPDATE DASHBOARD STATS ===
    function updateDashboardStats() {
      const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
      const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
      const articles = JSON.parse(localStorage.getItem('articles')) || [];
      
      document.getElementById('total-volunteers').textContent = volunteers.length;
      document.getElementById('total-incidents').textContent = incidents.filter(i => i.status === 'aktif').length;
      document.getElementById('total-articles').textContent = articles.length;
      document.getElementById('total-alerts').textContent = incidents.filter(i => i.status === 'aktif').length;
      
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      const oneWeekAgo = new Date();
      oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
      
      const newVolunteersThisMonth = volunteers.filter(v => {
        const volunteerDate = new Date(v.tanggalDaftar);
        return volunteerDate.getMonth() === currentMonth && volunteerDate.getFullYear() === currentYear;
      }).length;
      
      const newArticlesThisWeek = articles.filter(a => {
        const articleDate = new Date(a.date);
        return articleDate > oneWeekAgo;
      }).length;
      
      document.getElementById('quick-incidents').textContent = incidents.filter(i => i.status === 'aktif').length;
      document.getElementById('quick-volunteers').textContent = newVolunteersThisMonth;
      document.getElementById('quick-articles').textContent = newArticlesThisWeek;
      document.getElementById('quick-alerts').textContent = incidents.filter(i => i.status === 'aktif').length;
    }

    // === LOAD RECENT ACTIVITIES ===
    function loadRecentActivities() {
      const activities = [];
      const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
      const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
      const articles = JSON.parse(localStorage.getItem('articles')) || [];
      
      volunteers.slice(-5).forEach(volunteer => {
        activities.push({
          type: 'volunteer',
          title: 'Volunteer Baru Bergabung',
          description: `${volunteer.nama} telah bergabung sebagai volunteer`,
          time: new Date(volunteer.tanggalDaftar),
          icon: 'fas fa-user-plus',
          color: 'var(--success)'
        });
      });
      
      incidents.slice(-5).forEach(incident => {
        activities.push({
          type: 'incident',
          title: 'Kejadian Tsunami Dilaporkan',
          description: `Kejadian tsunami di ${incident.location} dengan magnitudo ${incident.magnitude}`,
          time: new Date(incident.date),
          icon: 'fas fa-wave-square',
          color: 'var(--danger)'
        });
      });
      
      articles.slice(-5).forEach(article => {
        activities.push({
          type: 'article',
          title: 'Artikel Baru Dipublikasi',
          description: `Artikel "${article.title}" telah dipublikasi`,
          time: new Date(article.date),
          icon: 'fas fa-newspaper',
          color: 'var(--primary)'
        });
      });
      
      activities.sort((a, b) => b.time - a.time);
      
      const activityList = document.getElementById('recent-activities');
      activityList.innerHTML = '';
      
      activities.slice(0, 5).forEach(activity => {
        const item = document.createElement('li');
        item.className = 'activity-item';
        
        const timeAgo = getTimeAgo(activity.time);
        
        item.innerHTML = `
          <div class="activity-icon" style="background: ${activity.color}">
            <i class="${activity.icon}"></i>
          </div>
          <div class="activity-content">
            <h4>${activity.title}</h4>
            <p>${activity.description}</p>
            <div class="activity-time">${timeAgo}</div>
          </div>
        `;
        
        activityList.appendChild(item);
      });
    }
    
    function getTimeAgo(date) {
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMins / 60);
      const diffDays = Math.floor(diffHours / 24);
      
      if (diffMins < 1) return 'Baru saja';
      if (diffMins < 60) return `${diffMins} menit yang lalu`;
      if (diffHours < 24) return `${diffHours} jam yang lalu`;
      if (diffDays < 7) return `${diffDays} hari yang lalu`;
      
      return date.toLocaleDateString('id-ID');
    }

    // === LOAD INCIDENTS ===
    function loadIncidents() {
      const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
      const tableBody = document.getElementById('incidents-table');
      
      tableBody.innerHTML = '';
      
      if (incidents.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">
              <i class="fas fa-info-circle"></i> Belum ada data kejadian
            </td>
          </tr>
        `;
        return;
      }
      
      incidents.forEach((incident, index) => {
        const row = document.createElement('tr');
        const statusText = {
          'aktif': 'Aktif',
          'pemantauan': 'Pemantauan',
          'selesai': 'Selesai'
        }[incident.status] || incident.status;
        
        const statusClass = {
          'aktif': 'status-danger',
          'pemantauan': 'status-warning',
          'selesai': 'status-active'
        }[incident.status] || 'status-pending';
        
        row.innerHTML = `
          <td>${new Date(incident.date).toLocaleDateString('id-ID')}</td>
          <td>${incident.location}</td>
          <td>${incident.magnitude}</td>
          <td><span class="status-badge ${statusClass}">${statusText}</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="editIncident(${index})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteIncident(${index})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // === EDIT INCIDENT ===
    function editIncident(index) {
      console.log('✏️ EDIT FUNCTION CALLED with index:', index);
      
      try {
        const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
        
        if (index < 0 || index >= incidents.length) {
          alert('❌ Data kejadian tidak ditemukan!');
          return;
        }
        
        const incident = incidents[index];
        const dateObj = new Date(incident.date);
        const formattedDate = dateObj.toISOString().split('T')[0];
        
        setTimeout(() => {
          document.getElementById('incident-date').value = formattedDate;
          document.getElementById('incident-location').value = incident.location;
          document.getElementById('incident-magnitude').value = incident.magnitude;
          document.getElementById('incident-depth').value = incident.depth;
          document.getElementById('incident-status').value = incident.status;
          document.getElementById('incident-description').value = incident.description || '';
          
          document.getElementById('edit-index').value = index;
          document.getElementById('form-title').textContent = 'Edit Kejadian Tsunami';
          document.getElementById('save-button-text').textContent = 'Update Kejadian';
        }, 100);
        
        showSection('add-incident');
        
      } catch (error) {
        console.error('❌ Error in editIncident:', error);
        alert('Terjadi error saat memuat data untuk edit: ' + error.message);
      }
    }

    // === SAVE INCIDENT ===
    function saveIncident() {
      try {
        const date = document.getElementById('incident-date').value;
        const location = document.getElementById('incident-location').value;
        const magnitude = document.getElementById('incident-magnitude').value;
        const depth = document.getElementById('incident-depth').value;
        const status = document.getElementById('incident-status').value;
        const description = document.getElementById('incident-description').value;
        const editIndex = parseInt(document.getElementById('edit-index').value);
        
        if (!date || !location || !magnitude || !depth || !status) {
          showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
          return false;
        }
        
        if (magnitude < 0 || magnitude > 10) {
          showNotification('Magnitudo harus antara 0 dan 10', 'error');
          return false;
        }
        
        if (depth < 0 || depth > 1000) {
          showNotification('Kedalaman harus antara 0 dan 1000 km', 'error');
          return false;
        }
        
        const incidentData = {
          date: date,
          location: location,
          magnitude: parseFloat(magnitude),
          depth: parseFloat(depth),
          status: status,
          description: description,
          createdAt: new Date().toISOString()
        };
        
        const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
        
        if (editIndex >= 0) {
          incidents[editIndex] = incidentData;
        } else {
          incidents.push(incidentData);
        }
        
        localStorage.setItem('incidents', JSON.stringify(incidents));
        
        syncDataToUserPage();
        
        if (editIndex >= 0) {
          showNotification('Kejadian berhasil diperbarui!', 'success');
        } else {
          showNotification('Kejadian berhasil ditambahkan!', 'success');
        }
        
        showSection('incidents');
        
        return true;
        
      } catch (error) {
        console.error('❌ Error in saveIncident:', error);
        showNotification('Terjadi error: ' + error.message, 'error');
        return false;
      }
    }

    // === DELETE INCIDENT ===
    function deleteIncident(index) {
      if (confirm('Apakah Anda yakin ingin menghapus kejadian ini?')) {
        const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
        incidents.splice(index, 1);
        localStorage.setItem('incidents', JSON.stringify(incidents));
        
        syncDataToUserPage();
        
        loadIncidents();
        updateDashboardStats();
        loadRecentActivities();
        showNotification('Kejadian berhasil dihapus!', 'success');
      }
    }

    // === LOAD ARTICLES ===
    function loadArticles() {
      const articles = JSON.parse(localStorage.getItem('articles')) || [];
      const tableBody = document.getElementById('articles-table');
      
      tableBody.innerHTML = '';
      
      if (articles.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="5" style="text-align: center; padding: 20px;">
              <i class="fas fa-info-circle"></i> Belum ada data artikel
            </td>
          </tr>
        `;
        return;
      }
      
      articles.forEach((article, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${article.title}</td>
          <td>${article.category}</td>
          <td>${new Date(article.date).toLocaleDateString('id-ID')}</td>
          <td><span class="status-badge status-active">Publik</span></td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="editArticle(${index})">
                <i class="fas fa-edit"></i> Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteArticle(${index})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
    }

    // === EDIT ARTICLE ===
    function editArticle(index) {
      try {
        const articles = JSON.parse(localStorage.getItem('articles')) || [];
        
        if (index < 0 || index >= articles.length) {
          alert('❌ Data artikel tidak ditemukan!');
          return;
        }
        
        const article = articles[index];
        const dateObj = new Date(article.date);
        const formattedDate = dateObj.toISOString().split('T')[0];
        
        setTimeout(() => {
          document.getElementById('article-title').value = article.title;
          document.getElementById('article-category').value = article.category;
          document.getElementById('article-date').value = formattedDate;
          document.getElementById('article-image').value = article.image || '';
          document.getElementById('article-content').value = article.content;
          document.getElementById('article-external-link').value = article.externalLink || '';
          
          document.getElementById('article-edit-index').value = index;
          document.getElementById('article-form-title').textContent = 'Edit Artikel';
          document.getElementById('save-article-button-text').textContent = 'Update Artikel';
        }, 100);
        
        showSection('add-article');
        
      } catch (error) {
        console.error('❌ Error in editArticle:', error);
        alert('Terjadi error saat memuat data untuk edit: ' + error.message);
      }
    }

    // === SAVE ARTICLE ===
    function saveArticle() {
      try {
        const title = document.getElementById('article-title').value;
        const category = document.getElementById('article-category').value;
        const date = document.getElementById('article-date').value;
        const image = document.getElementById('article-image').value;
        const content = document.getElementById('article-content').value;
        const externalLink = document.getElementById('article-external-link').value;
        const editIndex = parseInt(document.getElementById('article-edit-index').value);
        
        if (!title || !category || !date || !content || !externalLink) {
          showNotification('Harap lengkapi semua field yang wajib diisi!', 'error');
          return false;
        }
        
        try {
          new URL(externalLink);
        } catch (e) {
          showNotification('Format link eksternal tidak valid!', 'error');
          return false;
        }
        
        const articleData = {
          title: title,
          category: category,
          date: date,
          image: image,
          content: content,
          externalLink: externalLink,
          createdAt: new Date().toISOString()
        };
        
        const articles = JSON.parse(localStorage.getItem('articles')) || [];
        
        if (editIndex >= 0) {
          articles[editIndex] = articleData;
        } else {
          articles.push(articleData);
        }
        
        localStorage.setItem('articles', JSON.stringify(articles));
        syncArticlesToUserPage();
        
        if (editIndex >= 0) {
          showNotification('Artikel berhasil diperbarui!', 'success');
        } else {
          showNotification('Artikel berhasil ditambahkan!', 'success');
        }
        
        showSection('articles');
        
        return true;
        
      } catch (error) {
        console.error('❌ Error in saveArticle:', error);
        showNotification('Terjadi error: ' + error.message, 'error');
        return false;
      }
    }

    // === DELETE ARTICLE ===
    function deleteArticle(index) {
      if (confirm('Apakah Anda yakin ingin menghapus artikel ini?')) {
        const articles = JSON.parse(localStorage.getItem('articles')) || [];
        articles.splice(index, 1);
        localStorage.setItem('articles', JSON.stringify(articles));
        
        syncArticlesToUserPage();
        loadArticles();
        updateDashboardStats();
        loadRecentActivities();
        showNotification('Artikel berhasil dihapus!', 'success');
      }
    }

    // === SYNC DATA TO USER PAGE ===
    function syncDataToUserPage() {
      const incidents = JSON.parse(localStorage.getItem('incidents')) || [];
      
      const userIncidents = incidents.map(incident => {
        let statusClass = 'status-selesai';
        let statusText = 'Selesai';
        
        if (incident.status === 'aktif') {
          statusClass = 'status-aktif';
          statusText = 'Aktif';
        } else if (incident.status === 'pemantauan') {
          statusClass = 'status-pemantauan';
          statusText = 'Pemantauan';
        }
        
        const date = new Date(incident.date);
        const formattedDate = date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'short',
          year: 'numeric'
        });
        
        return {
          tanggal: formattedDate,
          lokasi: incident.location,
          magnitudo: incident.magnitude + ' SR',
          status: `<span class="status-badge ${statusClass}">${statusText}</span>`,
          volunteer: incident.status === 'selesai' ? 
            '<button class="daftar-btn" disabled><i class="fas fa-ban"></i> Tidak Tersedia</button>' :
            `<button class="daftar-btn" onclick="daftarVolunteer('${incident.location}')"><i class="fas fa-user-plus"></i> Daftar</button>`
        };
      });
      
      localStorage.setItem('userIncidentsData', JSON.stringify(userIncidents));
      
      const activeIncidents = incidents.filter(i => i.status === 'aktif').length;
      const monitoringIncidents = incidents.filter(i => i.status === 'pemantauan').length;
      const completedIncidents = incidents.filter(i => i.status === 'selesai').length;
      
      const stats = {
        total: incidents.length,
        active: activeIncidents,
        monitoring: monitoringIncidents,
        completed: completedIncidents
      };
      
      localStorage.setItem('userIncidentsStats', JSON.stringify(stats));
    }

    function syncArticlesToUserPage() {
      const articles = JSON.parse(localStorage.getItem('articles')) || [];
      
      const userArticles = articles.map(article => {
        const date = new Date(article.date);
        const formattedDate = date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'short',
          year: 'numeric'
        });
        
        return {
          title: article.title,
          category: article.category,
          date: formattedDate,
          image: article.image,
          content: article.content,
          externalLink: article.externalLink,
          author: article.author || "Admin Waver"
        };
      });
      
      localStorage.setItem('userArticlesData', JSON.stringify(userArticles));
    }

    // === VOLUNTEER MANAGEMENT ===
    let currentVolunteerIndex = -1;

    function loadVolunteers() {
      console.log('📥 Loading volunteers data...');
      
      const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
      const tableBody = document.getElementById('volunteers-table');
      
      updateVolunteerStats(volunteers);
      populateLocationFilter(volunteers);
      
      const searchTerm = document.getElementById('search-volunteer')?.value.toLowerCase() || '';
      const locationFilter = document.getElementById('filter-location')?.value || '';
      const sortOrder = document.getElementById('sort-volunteers')?.value || 'newest';
      
      let filteredVolunteers = volunteers.filter(v => {
        const matchSearch = !searchTerm || 
          v.nama.toLowerCase().includes(searchTerm) ||
          v.email.toLowerCase().includes(searchTerm) ||
          v.lokasi.toLowerCase().includes(searchTerm);
        
        const matchLocation = !locationFilter || v.lokasi === locationFilter;
        
        return matchSearch && matchLocation;
      });
      
      filteredVolunteers.sort((a, b) => {
        if (sortOrder === 'newest') {
          return new Date(b.tanggalDaftar) - new Date(a.tanggalDaftar);
        } else if (sortOrder === 'oldest') {
          return new Date(a.tanggalDaftar) - new Date(b.tanggalDaftar);
        } else if (sortOrder === 'name') {
          return a.nama.localeCompare(b.nama);
        }
        return 0;
      });
      
      tableBody.innerHTML = '';
      
      if (filteredVolunteers.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px;">
              <i class="fas fa-user-slash" style="font-size: 48px; color: #ccc; margin-bottom: 15px; display: block;"></i>
              <strong>Belum ada data volunteer</strong>
              <p style="color: #999; margin-top: 10px;">Data volunteer yang mendaftar akan muncul di sini</p>
            </td>
          </tr>
        `;
        return;
      }
      
      filteredVolunteers.forEach((volunteer, index) => {
        const originalIndex = volunteers.findIndex(v => 
          v.email === volunteer.email && v.tanggalDaftar === volunteer.tanggalDaftar
        );
        
        const row = document.createElement('tr');
        const date = new Date(volunteer.tanggalDaftar);
        const formattedDate = date.toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'short',
          year: 'numeric'
        });
        
        row.innerHTML = `
          <td>${formattedDate}</td>
          <td><strong>${volunteer.nama}</strong></td>
          <td>${volunteer.email}</td>
          <td>${volunteer.telepon}</td>
          <td>${volunteer.lokasi}</td>
          <td>${volunteer.usia} tahun</td>
          <td>
            <div class="action-buttons">
              <button class="btn btn-primary btn-sm" onclick="viewVolunteerDetail(${originalIndex})">
                <i class="fas fa-eye"></i> Detail
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteVolunteer(${originalIndex})">
                <i class="fas fa-trash"></i> Hapus
              </button>
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      console.log('✅ Loaded', filteredVolunteers.length, 'volunteers');
    }

    function updateVolunteerStats(volunteers) {
      const total = volunteers.length;
      
      const currentMonth = new Date().getMonth();
      const currentYear = new Date().getFullYear();
      const monthlyVolunteers = volunteers.filter(v => {
        const date = new Date(v.tanggalDaftar);
        return date.getMonth() === currentMonth && date.getFullYear() === currentYear;
      }).length;
      
      const oneWeekAgo = new Date();
      oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);
      const weeklyVolunteers = volunteers.filter(v => {
        const date = new Date(v.tanggalDaftar);
        return date >= oneWeekAgo;
      }).length;
      
      document.getElementById('total-volunteers-count').textContent = total;
      document.getElementById('monthly-volunteers-count').textContent = monthlyVolunteers;
      document.getElementById('weekly-volunteers-count').textContent = weeklyVolunteers;
    }

    function populateLocationFilter(volunteers) {
      const locations = [...new Set(volunteers.map(v => v.lokasi))];
      const filterSelect = document.getElementById('filter-location');
      
      const currentValue = filterSelect.value;
      filterSelect.innerHTML = '<option value="">Semua Lokasi</option>';
      
      locations.forEach(location => {
        const option = document.createElement('option');
        option.value = location;
        option.textContent = location;
        filterSelect.appendChild(option);
      });
      
      filterSelect.value = currentValue;
    }

    function viewVolunteerDetail(index) {
      const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
      const volunteer = volunteers[index];
      
      if (!volunteer) {
        showNotification('Data volunteer tidak ditemukan!', 'error');
        return;
      }
      
      currentVolunteerIndex = index;
      
      const date = new Date(volunteer.tanggalDaftar);
      const formattedDate = date.toLocaleDateString('id-ID', {
        weekday: 'long',
        day: 'numeric',
        month: 'long',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const detailContent = document.getElementById('volunteer-detail-content');
      detailContent.innerHTML = `
        <div style="display: grid; gap: 20px;">
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Tanggal Daftar:</strong>
            <span>${formattedDate}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Nama Lengkap:</strong>
            <span>${volunteer.nama}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Email:</strong>
            <span>${volunteer.email}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Nomor Telepon:</strong>
            <span>${volunteer.telepon}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Lokasi Volunteer:</strong>
            <span>${volunteer.lokasi}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Alamat Lengkap:</strong>
            <span>${volunteer.alamat}</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Usia:</strong>
            <span>${volunteer.usia} tahun</span>
          </div>
          
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Alasan:</strong>
            <span style="white-space: pre-wrap;">${volunteer.alasan}</span>
          </div>
          
          ${volunteer.pengalaman ? `
          <div class="detail-row" style="display: grid; grid-template-columns: 180px 1fr; gap: 15px; padding: 15px; background: #f8faff; border-radius: 10px;">
            <strong style="color: var(--dark);">Pengalaman:</strong>
            <span style="white-space: pre-wrap;">${volunteer.pengalaman}</span>
          </div>
          ` : ''}
        </div>
      `;
      
      document.getElementById('volunteer-detail-modal').style.display = 'block';
    }

    function closeVolunteerModal() {
      document.getElementById('volunteer-detail-modal').style.display = 'none';
      currentVolunteerIndex = -1;
    }

    function deleteVolunteerFromModal() {
      if (currentVolunteerIndex >= 0) {
        deleteVolunteer(currentVolunteerIndex);
        closeVolunteerModal();
      }
    }

    function deleteVolunteer(index) {
      if (confirm('Apakah Anda yakin ingin menghapus data volunteer ini?')) {
        const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
        const deletedVolunteer = volunteers[index];
        
        volunteers.splice(index, 1);
        localStorage.setItem('volunteers', JSON.stringify(volunteers));
        
        loadVolunteers();
        updateDashboardStats();
        loadRecentActivities();
        
        showNotification(`Data volunteer ${deletedVolunteer.nama} berhasil dihapus!`, 'success');
      }
    }

    function exportVolunteerData() {
      const volunteers = JSON.parse(localStorage.getItem('volunteers')) || [];
      
      if (volunteers.length === 0) {
        showNotification('Tidak ada data untuk di-export!', 'warning');
        return;
      }
      
      const headers = ['Tanggal Daftar', 'Nama', 'Email', 'Telepon', 'Lokasi', 'Alamat', 'Usia', 'Alasan', 'Pengalaman'];
      const rows = volunteers.map(v => [
        new Date(v.tanggalDaftar).toLocaleString('id-ID'),
        v.nama,
        v.email,
        v.telepon,
        v.lokasi,
        v.alamat,
        v.usia,
        `"${v.alasan.replace(/"/g, '""')}"`,
        `"${(v.pengalaman || '').replace(/"/g, '""')}"`
      ]);
      
      const csv = [headers, ...rows].map(row => row.join(',')).join('\n');
      
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      
      link.setAttribute('href', url);
      link.setAttribute('download', `volunteer_data_${new Date().toISOString().split('T')[0]}.csv`);
      link.style.visibility = 'hidden';
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      showNotification('Data volunteer berhasil di-export!', 'success');
    }

    // === NOTIFICATION ===
    function showNotification(message, type = 'success') {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.className = `notification ${type}`;
      notification.classList.add('show');
      
      setTimeout(() => {
        notification.classList.remove('show');
      }, 3000);
    }

    // === EVENT LISTENERS ===
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🎯 DOM fully loaded and initialized');
      
      initializeData();
      initializeMapData();
      updateDashboardStats();
      loadRecentActivities();
      syncDataToUserPage();
      
      showSection('dashboard');
      
      const searchInput = document.getElementById('search-volunteer');
      const locationFilter = document.getElementById('filter-location');
      const sortSelect = document.getElementById('sort-volunteers');
      
      if (searchInput) {
        searchInput.addEventListener('input', loadVolunteers);
      }
      
      if (locationFilter) {
        locationFilter.addEventListener('change', loadVolunteers);
      }
      
      if (sortSelect) {
        sortSelect.addEventListener('change', loadVolunteers);
      }
      
      console.log('✅ Application initialized successfully');
    });
    
  </script>
</body>
</html>